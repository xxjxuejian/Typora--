关于双Token登录系统，这是一种在现代Web应用和移动应用中广泛采用的用户认证机制，旨在提高安全性的同时，优化用户体验。其核心思想是使用两种不同生命周期的令牌（Token）来管理用户的登录状态。

### 核心组成：两种令牌各司其职

双Token登录系统主要包含以下两种令牌：

- **访问令牌（Access Token）**: 这是客户端访问受保护资源时需要携带的令牌。它的特点是 **生命周期短**，通常只有几分钟到几小时。由于其时效性短，即使被窃取，攻击者也只能在很短的时间内利用它，从而降低了安全风险。
- **刷新令牌（Refresh Token）**: 当访问令牌过期后，客户端会使用刷新令牌来获取一个新的访问令牌。刷新令牌的 **生命周期较长**，可以是几天甚至几个月。它通常只在访问令牌失效时才会被发送到服务器，从而减少了在网络中传输的频率，提高了安全性。



### 工作流程：无缝刷新，体验更佳

双Token登录系统的认证流程大致如下：

1. **用户登录**：用户使用用户名和密码进行登录。服务器验证通过后，会生成一个访问令牌和一个刷新令牌，并将它们一同返回给客户端。
2. **访问资源**：客户端会将访问令牌存储起来（通常在内存中），并在每次请求需要身份认证的接口时，在请求头中携带该令牌。
3. **访问令牌过期**：当访问令牌过期后，服务器会拒绝该请求。
4. **刷新令牌**：客户端在收到访问令牌过期的响应后，会使用之前存储的刷新令牌向服务器请求一个新的访问令牌。
5. **获取新令牌**：服务器验证刷新令牌的有效性。如果有效，则生成一个新的访问令牌（有时也会同时返回一个新的刷新令牌）给客户端。
6. **无感刷新**：客户端收到新的访问令牌后，会更新本地存储的令牌，并自动用新的令牌重新发起之前失败的请求。这个过程对用户来说是透明的，无需重新登录，从而实现了“无感刷新”。
7. **刷新令牌过期**：如果刷新令牌也过期了，那么用户就需要重新进行登录操作。



### 前端代码：

#### axios拦截器

axios拦截器中需要关注三个点：

1. 请求拦截器中添加请求头：`Authorization`
2. 响应拦截器中针对`Access Token`过期的处理
3. 处理由于Token过期而失败的请求



怎么处理因为Token过期失败的请求

每一个网络请求函数，实际发送请求的代码`request({config})`，这样的代码：

![image-20250717200147596](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20250717200147596.png)

`request`是`axios`封装的请求实例，`request({})`内部的对象，是一个`config`配置对象，这个对象就是**请求拦截器**中的`config`，网络请求发送失败了，实际上是`request({config})`这个失败了。为了后面重新发送，我们肯定需要把每一个类似的请求函数都保存下来。



### 后端代码：