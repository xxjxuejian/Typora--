å›¾ç‰‡æ‡’åŠ è½½æ–¹å¼æœ‰å“ªäº›



#### 1ï¸âƒ£ åŸç”Ÿ `loading="lazy"`ï¼ˆæœ€çœå¿ƒ â­â­â­â­â­ï¼‰

```html
<img src="xxx.jpg" loading="lazy" />
```



[`HTMLImageElement`](https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLImageElement) çš„ **`loading`** å±æ€§ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒçš„å€¼ä¼šæç¤º[ç”¨æˆ·ä»£ç†](https://developer.mozilla.org/zh-CN/docs/Glossary/User_agent)å‘Šè¯‰æµè§ˆå™¨**ä¸åœ¨**[å¯è§†è§†å£](https://developer.mozilla.org/zh-CN/docs/Glossary/Visual_Viewport)å†…çš„å›¾ç‰‡è¯¥å¦‚ä½•åŠ è½½ã€‚è¿™æ ·ä¸€æ¥ï¼Œé€šè¿‡æ¨è¿Ÿå›¾ç‰‡åŠ è½½ä»…è®©å…¶åœ¨éœ€è¦çš„æ—¶å€™åŠ è½½è€Œéé¡µé¢åˆå§‹è½½å…¥æ—¶ç«‹åˆ»åŠ è½½ï¼Œä¼˜åŒ–äº†é¡µé¢çš„è½½å…¥ã€‚

##### å€¼ï¼š

- `eager (é»˜è®¤å€¼) `

  é»˜è®¤è¡Œä¸ºï¼Œ `eager` å‘Šè¯‰æµè§ˆå™¨å½“å¤„ç† `<img>` æ ‡ç­¾æ—¶ç«‹å³åŠ è½½å›¾ç‰‡ã€‚

- `lazy`

  å‘Šè¯‰ç”¨æˆ·ä»£ç†æ¨è¿Ÿå›¾ç‰‡åŠ è½½ç›´åˆ°æµè§ˆå™¨è®¤ä¸ºå…¶éœ€è¦ç«‹å³åŠ è½½æ—¶æ‰å»åŠ è½½ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç”¨æˆ·æ­£åœ¨å¾€ä¸‹æ»šåŠ¨é¡µé¢ï¼Œå€¼ä¸º `lazy` ä¼šå¯¼è‡´å›¾ç‰‡ä»…åœ¨é©¬ä¸Šè¦å‡ºç°åœ¨[å¯è§†è§†å£](https://developer.mozilla.org/zh-CN/docs/Glossary/Visual_Viewport)ä¸­æ—¶å¼€å§‹åŠ è½½ã€‚

##### ä½¿ç”¨è¯´æ˜ï¼š

**`load`** äº‹ä»¶åœ¨**æ•´ä¸ªé¡µé¢åŠæ‰€æœ‰ä¾èµ–èµ„æºå¦‚æ ·å¼è¡¨å’Œå›¾ç‰‡éƒ½**å·²å®ŒæˆåŠ è½½æ—¶è§¦å‘ã€‚

å½“å›¾ç‰‡ä½¿ç”¨`eager`ç«‹å³åŠ è½½ï¼ˆé»˜è®¤å€¼ï¼‰æ—¶ï¼Œæ–‡æ¡£ä¸­çš„æ‰€æœ‰å›¾ç‰‡éƒ½ä¼šåœ¨ `load` äº‹ä»¶**è§¦å‘å‰**è½½å…¥ã€‚

å½“ `loading` å€¼è®¾ä¸º `lazy` æ—¶ï¼Œå›¾ç‰‡ä¸å†ä¼šåœ¨è¯·æ±‚ï¼Œä¸‹è½½ï¼Œå¤„ç†çš„æ—¶é—´å†…æ¨è¿Ÿ `load` äº‹ä»¶è§¦å‘ã€‚

##### ç‰¹ç‚¹

- æµè§ˆå™¨åŸç”Ÿæ”¯æŒ
- **é›¶ JSã€é›¶ä¾èµ–**
- ç°ä»£æµè§ˆå™¨ï¼ˆChrome / Edge / Firefox / Safari æ–°ç‰ˆï¼‰éƒ½ OK

##### ä¼˜ç‚¹

- å®ç°æˆæœ¬ â‰ˆ 0
- æ€§èƒ½å¥½ã€ç¨³å®š
- SSR / CSR éƒ½é€‚åˆ

##### æ³¨æ„ç‚¹

- ä¸èƒ½ç²¾ç»†æ§åˆ¶åŠ è½½æ—¶æœº
- è€æ—§æµè§ˆå™¨ä¸æ”¯æŒï¼ˆä½†ç°åœ¨å½±å“å¾ˆå°ï¼‰

ğŸ‘‰ **ç»“è®º**ï¼š
 **èƒ½ç”¨å°±å…ˆç”¨è¿™ä¸ª**ï¼Œå¾ˆå¤šæ—¶å€™å·²ç»å¤Ÿäº†ã€‚

------

#### 2ï¸âƒ£ `IntersectionObserver`ï¼ˆä¸»æµ & æœ€æ¨è â­â­â­â­â­ï¼‰

```js
const observer = new IntersectionObserver(entries => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      const img = entry.target;
      img.src = img.dataset.src;
      observer.unobserve(img);
    }
  });
});

document.querySelectorAll('img[data-src]').forEach(img => {
  observer.observe(img);
});
<img data-src="real.jpg" src="placeholder.jpg" />
```

##### åŸç†

- **ç›‘å¬å…ƒç´ æ˜¯å¦è¿›å…¥è§†å£**
- ä¸ç”¨ç›‘å¬ scrollï¼Œæ€§èƒ½å‹å¥½

##### ä¼˜ç‚¹

- å¯æ§æ€§å¼º
- æ€§èƒ½å¥½ï¼ˆæµè§ˆå™¨åº•å±‚ä¼˜åŒ–ï¼‰
- å¯ä»¥åšé¢„åŠ è½½ã€åŠ¨ç”»ã€åŸ‹ç‚¹

##### å¸¸è§é…ç½®

```js
new IntersectionObserver(callback, {
  rootMargin: '100px', // æå‰ 100px åŠ è½½
  threshold: 0.1
});
```

##### é€‚åˆ

- åˆ—è¡¨ / å›¾ç‰‡æµ
- Vue / React é¡¹ç›®
- ç§»åŠ¨ç«¯ & PC

ğŸ‘‰ **ç»“è®º**ï¼š
 **çœŸå®é¡¹ç›®é‡Œæœ€å¸¸ç”¨ã€æœ€ä¼˜é›…çš„ä¸€ç§**

------

#### 3ï¸âƒ£ ç›‘å¬ `scroll`ï¼ˆä¼ ç»Ÿæ–¹æ¡ˆï¼Œå…œåº•ç”¨ â­â­â­ï¼‰

```js
function lazyLoad() {
  const imgs = document.querySelectorAll('img[data-src]');
  imgs.forEach(img => {
    const rect = img.getBoundingClientRect();
    if (rect.top < window.innerHeight) {
      img.src = img.dataset.src;
      img.removeAttribute('data-src');
    }
  });
}

window.addEventListener('scroll', throttle(lazyLoad, 200));
```

##### ç‰¹ç‚¹

- åŸç†ç®€å•
- å…¼å®¹æ€§æœ€å¥½

##### ç¼ºç‚¹

- **æ€§èƒ½ä¸€èˆ¬**
- éœ€è¦èŠ‚æµ / é˜²æŠ–
- å®¹æ˜“å†™å‡º bug

ğŸ‘‰ **ç»“è®º**ï¼š
 **ä¸æ¨èæ–°é¡¹ç›®ä½¿ç”¨**ï¼Œä¸»è¦ç”¨äºå…¼å®¹è€æµè§ˆå™¨

------

#### 4ï¸âƒ£ èƒŒæ™¯å›¾æ‡’åŠ è½½ï¼ˆ`background-image`ï¼‰

æœ‰æ—¶å€™ä¸æ˜¯ `<img>`ï¼Œè€Œæ˜¯èƒŒæ™¯å›¾ï¼š

```html
<div class="img" data-bg="xxx.jpg"></div>
```

```js
entry.target.style.backgroundImage = `url(${bg})`;
```

##### é€‚åˆ

- å¡ç‰‡èƒŒæ™¯
- banner
- ä¸éœ€è¦ SEO çš„å›¾ç‰‡