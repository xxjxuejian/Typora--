`Cesium.CustomDataSource` æ˜¯ Cesium ä¸­ä¸€ä¸ªéžå¸¸å¸¸ç”¨ã€ä¹Ÿéžå¸¸å®žç”¨çš„**å®žä½“ç®¡ç†å®¹å™¨**ã€‚
 å®ƒå¯ä»¥ç†è§£ä¸ºä¸€ä¸ª**è‡ªå®šä¹‰çš„å›¾å±‚ï¼ˆLayerï¼‰**ï¼Œç”¨æ¥ç»„ç»‡å’Œç®¡ç†ä¸€ç»„ `Entity`ï¼Œè€Œä¸æ˜¯ç›´æŽ¥æŠŠå®žä½“å…¨éƒ¨ä¸¢åˆ°å…¨å±€çš„ `viewer.entities` é‡Œã€‚



## ä»‹ç»

### ðŸ§© ä¸€ã€ä½œç”¨æ¦‚è¿°

åœ¨ Cesium ä¸­ï¼š

- æ‰€æœ‰çš„å®žä½“ (`Entity`) å¿…é¡»å±žäºŽæŸä¸ª **EntityCollection**ï¼›
- `viewer.entities` å°±æ˜¯é»˜è®¤çš„å…¨å±€ `EntityCollection`ï¼›
- `CustomDataSource` æä¾›äº†ä¸€ä¸ª **ç‹¬ç«‹çš„æ•°æ®æºï¼ˆç‹¬ç«‹çš„å®žä½“é›†åˆï¼‰**ï¼Œå®ƒå†…éƒ¨ä¹Ÿæœ‰è‡ªå·±çš„ `entities`ï¼›
- ä½ å¯ä»¥æŠŠå®ƒçœ‹ä½œæ˜¯**ä¸€ä¸ªå¯å‘½åã€å¯ç‹¬ç«‹æŽ§åˆ¶æ˜¾éš/ç§»é™¤çš„å®žä½“å›¾å±‚**ã€‚

ðŸ‘‰ ç”¨å®ƒå¯ä»¥æ–¹ä¾¿åœ°ï¼š

- ç»„ç»‡ä¸åŒç±»åž‹çš„å®žä½“ï¼ˆæ¯”å¦‚â€œéš§é“ç‚¹ä½å±‚â€ã€â€œè½¦è¾†å±‚â€ã€â€œè­¦æŠ¥å±‚â€ç­‰ï¼‰ï¼›
- ä¸€æ¬¡æ€§æ·»åŠ æˆ–ç§»é™¤ä¸€æ•´ç»„å®žä½“ï¼›
- å•ç‹¬æŽ§åˆ¶æŸä¸€ç±»å®žä½“çš„æ˜¾ç¤ºéšè—ï¼›
- å¯¹å®žä½“è¿›è¡Œé€»è¾‘åˆ†ç»„ç®¡ç†ï¼Œé¿å… `viewer.entities` è¿‡äºŽæ··ä¹±ã€‚

------



### ðŸ§± äºŒã€åŸºæœ¬ç”¨æ³•

#### âœ… 1. åˆ›å»ºä¸€ä¸ª CustomDataSource

```js
const tunnelLayer = new Cesium.CustomDataSource("tunnel-layer");
```

#### âœ… 2. æ·»åŠ å®žä½“åˆ°è¯¥æ•°æ®æº

```js
tunnelLayer.entities.add({
  id: "tunnel-1",
  name: "Aå·éš§é“",
  position: Cesium.Cartesian3.fromDegrees(116.39, 39.9, 50),
  point: {
    pixelSize: 10,
    color: Cesium.Color.YELLOW,
  },
});
```

#### âœ… 3. æŠŠæ•°æ®æºæ·»åŠ åˆ° Viewer

```js
viewer.dataSources.add(tunnelLayer);
```

çŽ°åœ¨ï¼Œ`tunnelLayer` é‡Œçš„æ‰€æœ‰å®žä½“éƒ½ä¼šæ˜¾ç¤ºåœ¨åœ°å›¾ä¸Šã€‚

------

### ðŸª„ ä¸‰ã€å¸¸ç”¨æ“ä½œ

#### 1ï¸âƒ£ èŽ·å–æŸä¸ªæ•°æ®æº

```js
const layer = viewer.dataSources.getByName("tunnel-layer")[0];
```

#### 2ï¸âƒ£ ç§»é™¤æ•´ä¸ªæ•°æ®æº

```js
viewer.dataSources.remove(layer);
```

> ç§»é™¤åŽå›¾å±‚å’Œå…¶ä¸­çš„å®žä½“éƒ½ä¸ä¼šæ˜¾ç¤ºï¼Œä½†ä»ç„¶å¯ä»¥ä¿ç•™åœ¨å†…å­˜ä¸­ï¼ˆå¯é€‰ç¬¬äºŒä¸ªå‚æ•°ï¼‰ã€‚

```js
viewer.dataSources.remove(layer, false); // ä¸é”€æ¯å¯¹è±¡
```

#### 3ï¸âƒ£ æ˜¾ç¤º/éšè—å›¾å±‚

```js
layer.show = false; // éšè—æ•´å±‚
layer.show = true;  // æ˜¾ç¤ºæ•´å±‚
```

#### 4ï¸âƒ£ æ¸…ç©ºå½“å‰æ•°æ®æºçš„å®žä½“

```js
layer.entities.removeAll();
```

#### 5ï¸âƒ£ æŸ¥æ‰¾æˆ–æ›´æ–°æŸä¸ªå®žä½“

```js
const e = layer.entities.getById("tunnel-1");
if (e) e.point.color = Cesium.Color.RED;
```

------

### âš™ï¸ å››ã€å…¸åž‹åº”ç”¨åœºæ™¯

| åœºæ™¯                          | ç”¨æ³•                                                        |
| ----------------------------- | ----------------------------------------------------------- |
| åˆ†ç»„ç®¡ç†ä¸åŒä¸šåŠ¡æ•°æ®          | å»ºç«‹å¤šä¸ª `CustomDataSource`ï¼Œå¦‚é“è·¯ç›‘æŽ§å±‚ã€éš§é“å±‚ã€ä¼ æ„Ÿå™¨å±‚ |
| åŠ¨æ€æ›´æ–°                      | æ›´æ–°æ—¶æ¸…ç©º `layer.entities` å†é‡æ–°æ·»åŠ                       |
| æŒ‰éœ€æ˜¾ç¤ºéšè—å›¾å±‚              | ç”¨ UI æŒ‰é’®æŽ§åˆ¶ `layer.show`                                 |
| åŠ è½½ GeoJSON æˆ–å…¶ä»–è‡ªå®šä¹‰æ•°æ® | è§£æžåŽé€ä¸ª `entities.add()`                                 |
| ä¸´æ—¶ç¼“å­˜æ•°æ®                  | ä¸æ·»åŠ åˆ° `viewer` å°±ä¸ä¼šæ˜¾ç¤º                                |

------

### ðŸ§  äº”ã€ä¸Žå…¶ä»–ç±»çš„åŒºåˆ«

| ç±»å                | è¯´æ˜Ž                                                         |
| ------------------- | ------------------------------------------------------------ |
| `EntityCollection`  | åŸºç¡€çš„å®žä½“é›†åˆï¼ˆCustomDataSource å†…éƒ¨å°±æ˜¯å®ƒï¼‰                |
| `viewer.entities`   | å…¨å±€é»˜è®¤é›†åˆï¼Œæ‰€æœ‰æœªåˆ†ç»„çš„å®žä½“éƒ½æ”¾è¿™é‡Œ                       |
| `CustomDataSource`  | **å¯å‘½åã€å¯æŽ§æ˜¾éšçš„è‡ªå®šä¹‰å®žä½“é›†åˆ**                         |
| `GeoJsonDataSource` | ä¸“é—¨è§£æž GeoJSON æ ¼å¼çš„ DataSourceï¼Œç»§æ‰¿è‡ª `CustomDataSource` |

------

### ðŸŒˆ å…­ã€ç¤ºä¾‹ï¼šå¤šä¸ªå›¾å±‚ç®¡ç†

```js
const tunnelLayer = new Cesium.CustomDataSource("tunnels");
const carLayer = new Cesium.CustomDataSource("cars");

// æ·»åŠ åˆ° viewer
viewer.dataSources.add(tunnelLayer);
viewer.dataSources.add(carLayer);

// æ·»åŠ å®žä½“
tunnelLayer.entities.add({ id: "t1", position: ..., point: {...} });
carLayer.entities.add({ id: "c1", position: ..., billboard: {...} });

// æŽ§åˆ¶æ˜¾éš
tunnelLayer.show = true;
carLayer.show = false;
```

------

### âœ… æ€»ç»“

| ç‰¹æ€§     | è¯´æ˜Ž                                                         |
| -------- | ------------------------------------------------------------ |
| ç±»åž‹     | `Cesium.CustomDataSource`                                    |
| åŠŸèƒ½     | ç®¡ç†ä¸€ç»„å®žä½“ï¼Œé€»è¾‘ä¸Šä½œä¸ºç‹¬ç«‹å›¾å±‚                             |
| ä¼˜ç‚¹     | å¯ç‹¬ç«‹æŽ§åˆ¶æ˜¾ç¤ºã€éšè—ã€æ¸…ç©ºã€ç§»é™¤                             |
| ä½¿ç”¨åœºæ™¯ | åˆ†å±‚ç®¡ç†ä¸åŒä¸šåŠ¡æ•°æ®ã€åŠ¨æ€æ›´æ–°å®žä½“ã€ç®€åŒ– viewer.entities ç®¡ç† |





## å›¾å±‚Layer

ç®€è€Œè¨€ä¹‹ï¼š

> ðŸ§© **Cesium ä¸­æ²¡æœ‰ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„â€œå›¾å±‚ï¼ˆLayerï¼‰â€æ¦‚å¿µã€‚**
>  Cesium çš„â€œLayerâ€æ€æƒ³æ˜¯ç”±å¤šä¸ªä¸åŒçš„ä½“ç³»æ¥**åˆ†åˆ«æ¨¡æ‹Ÿå®žçŽ°çš„**ã€‚
>  `CustomDataSource` å°±æ˜¯å…¶ä¸­ç”¨äºŽ**â€œå®žä½“å±‚ï¼ˆEntity Layerï¼‰â€ç®¡ç†çš„æ›¿ä»£æ–¹æ¡ˆ**ã€‚

ä¸‹é¢æˆ‘å¸®ä½ ç³»ç»Ÿåœ°è§£é‡Šæ¸…æ¥š ðŸ‘‡ðŸ‘‡ðŸ‘‡

------

### ðŸ—ºï¸ ä¸€ã€ä¼ ç»Ÿ GIS ä¸Ž Cesium çš„å·®å¼‚

åœ¨ä¼ ç»Ÿçš„ 2D GISï¼ˆå¦‚ ArcGISã€OpenLayersã€Mapboxï¼‰ä¸­ï¼Œ**Layer æ˜¯æ ¸å¿ƒæ¦‚å¿µ**ï¼š

- æ¯ä¸ª Layer ä»£è¡¨ä¸€ä¸ªå¯æ˜¾ç¤º/éšè—/ç‹¬ç«‹ç®¡ç†çš„æ•°æ®å±‚ï¼›
- Layer å¯ä»¥æ˜¯çŸ¢é‡å›¾å±‚ï¼ˆç‚¹ã€çº¿ã€é¢ï¼‰æˆ–æ …æ ¼å›¾å±‚ï¼ˆå½±åƒåº•å›¾ï¼‰ã€‚

ä½†æ˜¯åœ¨ **Cesiumï¼ˆ3D åœ°çƒï¼‰** ä¸­ï¼Œå†…éƒ¨æž¶æž„æ›´åº•å±‚å’Œçµæ´»ï¼Œ**å¹¶æ²¡æœ‰é€šç”¨çš„ â€œLayerâ€ ç±»**ã€‚
 Cesium æŠŠä¸åŒç±»åž‹çš„å¯è§†åŒ–å†…å®¹æ‹†æˆå‡ ä¸ªä½“ç³»ï¼š

------

### ðŸ§± äºŒã€Cesium ä¸­ç±»ä¼¼ â€œLayerâ€ çš„å‡ ä¸ªä½“ç³»

| ç±»åž‹                              | ä»£è¡¨ç±»                                 | åŠŸèƒ½                              | æ˜¯å¦â€œLayerâ€          |
| --------------------------------- | -------------------------------------- | --------------------------------- | -------------------- |
| **åº•å›¾å›¾å±‚ï¼ˆImagery Layerï¼‰**     | `ImageryLayer`                         | ç®¡ç†å½±åƒåº•å›¾ï¼Œå¦‚å«æ˜Ÿå›¾ã€è¡—é“å›¾    | âœ… æ˜¯çœŸæ­£æ„ä¹‰çš„å›¾å±‚   |
| **åœ°å½¢å›¾å±‚ï¼ˆTerrain Providerï¼‰**  | `CesiumTerrainProvider`                | æŽ§åˆ¶åœ°å½¢èµ·ä¼æ•°æ®æ¥æº              | âœ… å¯ä»¥çœ‹ä½œæ˜¯åœ°å½¢å±‚   |
| **å®žä½“å±‚ï¼ˆEntity Layerï¼‰**        | `CustomDataSource`                     | ç®¡ç†ä¸€ç»„ `Entity`ï¼ˆç‚¹çº¿é¢æ¨¡åž‹ç­‰ï¼‰ | âš™ï¸ æ¨¡æ‹Ÿå®žçŽ°çš„å›¾å±‚     |
| **åŽŸå§‹å‡ ä½•å±‚ï¼ˆPrimitive Layerï¼‰** | `PrimitiveCollection`                  | åº•å±‚å‡ ä½•é›†åˆï¼ˆæ€§èƒ½æ›´é«˜ï¼‰          | âš™ï¸ åº•å±‚ç‰ˆâ€œå›¾å±‚â€       |
| **æ•°æ®æºå±‚ï¼ˆDataSource Layerï¼‰**  | `GeoJsonDataSource` / `CzmlDataSource` | åŠ è½½å¤–éƒ¨æ•°æ®ï¼ˆGeoJSONã€CZML ç­‰ï¼‰  | âš™ï¸ é«˜å±‚å°è£…çš„å›¾å±‚æ¦‚å¿µ |

------

### ðŸŒ ä¸‰ã€`CustomDataSource` æ‰®æ¼”çš„è§’è‰²

`CustomDataSource` å¹¶ä¸æ˜¯ Cesium å†…éƒ¨çš„â€œæ­£å¼ Layer ç±»â€ï¼Œ
 ä½†å®ƒæ‰¿æ‹…äº† **â€œé€»è¾‘å›¾å±‚â€** çš„åŠŸèƒ½ï¼š

- å®ƒæ˜¯ä¸€ä¸ªå¯å‘½åçš„æ•°æ®å®¹å™¨ï¼›
- å†…éƒ¨æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ `EntityCollection`ï¼›
- å¯ä»¥æ•´ä½“æ·»åŠ ã€ç§»é™¤ã€æ˜¾ç¤ºã€éšè—ï¼›
- æ”¯æŒæ‰¹é‡æ“ä½œå®žä½“ï¼›
- å¯ä»¥é€šè¿‡ `viewer.dataSources` ç®¡ç†å¤šä¸ªè¿™æ ·çš„â€œå›¾å±‚â€ã€‚

ðŸ“˜ æ¢å¥è¯è¯´ï¼š

> `CustomDataSource` æ˜¯ Cesium åœ¨ Entity ç³»ç»Ÿé‡Œç”¨æ¥**æ¨¡æ‹Ÿå›¾å±‚æ¦‚å¿µçš„æœºåˆ¶**ã€‚

------

### ðŸ§  å››ã€å®žé™…é¡¹ç›®ä¸­çš„ç†è§£æ–¹å¼

åœ¨å·¥ç¨‹å®žè·µä¸­ï¼Œæˆ‘ä»¬é€šå¸¸è¿™ä¹ˆç†è§£ï¼š

| æƒ³æ³•                       | Cesium å®žçŽ°æ–¹å¼                                 |
| -------------------------- | ----------------------------------------------- |
| â€œåœ°å›¾åº•å›¾å±‚â€               | ç”¨ `ImageryLayer` æŽ§åˆ¶ï¼ˆæ·»åŠ æˆ–ç§»é™¤å½±åƒæœåŠ¡ï¼‰    |
| â€œåœ°å½¢å±‚â€                   | ç”¨ `TerrainProvider` æŽ§åˆ¶                       |
| â€œä¸šåŠ¡æ•°æ®å›¾å±‚ï¼ˆç‚¹/çº¿/é¢ï¼‰â€ | ç”¨ `CustomDataSource`ï¼ˆæˆ– `GeoJsonDataSource`ï¼‰ |
| â€œåº•å±‚é«˜æ€§èƒ½ç»˜åˆ¶å±‚â€         | ç”¨ `PrimitiveCollection` ç›´æŽ¥æ“ä½œ Primitive     |

ä¸¾ä¸ªä¾‹å­ï¼š

```js
// åº•å›¾å±‚ï¼šå«æ˜Ÿå½±åƒ
viewer.imageryLayers.addImageryProvider(
  new Cesium.UrlTemplateImageryProvider({ url: "https://tiles.mapbox.com/{z}/{x}/{y}.png" })
);

// ä¸šåŠ¡å±‚ï¼šéš§é“å®žä½“
const tunnelLayer = new Cesium.CustomDataSource("tunnel-layer");
tunnelLayer.entities.add({ id: "t1", position: ..., point: {...} });
viewer.dataSources.add(tunnelLayer);

// æŽ§åˆ¶æ˜¾éš
tunnelLayer.show = false; // ç›¸å½“äºŽéšè—è¯¥â€œå›¾å±‚â€
```

------

### âš™ï¸ äº”ã€å¦‚æžœä½ æƒ³ä¸¥æ ¼â€œåˆ†å±‚ç®¡ç†â€Cesiumæ•°æ®

å¯ä»¥æŒ‰å±‚åˆ†ç±»ï¼š

| å›¾å±‚ç±»åž‹    | ç®¡ç†å¯¹è±¡                | ç¤ºä¾‹ç±»                               |
| ----------- | ----------------------- | ------------------------------------ |
| å½±åƒå›¾å±‚    | viewer.imageryLayers    | ImageryLayer                         |
| åœ°å½¢å›¾å±‚    | viewer.terrainProvider  | CesiumTerrainProvider                |
| å®žä½“å›¾å±‚    | viewer.dataSources      | CustomDataSource / GeoJsonDataSource |
| Primitiveå±‚ | viewer.scene.primitives | PrimitiveCollection                  |

------

### âœ… å…­ã€æ€»ç»“ä¸€å¥è¯

> Cesium æ²¡æœ‰é€šç”¨çš„ `Layer` ç±»ã€‚
>  å®ƒæŠŠâ€œå›¾å±‚â€çš„æ¦‚å¿µæ‹†æˆå¤šä¸ªä½“ç³»ï¼š
>
> - å½±åƒ/åœ°å½¢ â†’ çœŸæ­£çš„ Layer
> - å®žä½“/ä¸šåŠ¡æ•°æ® â†’ ç”¨ `CustomDataSource` æ¨¡æ‹Ÿ Layer
> - åº•å±‚å‡ ä½• â†’ ç”¨ `PrimitiveCollection` å®žçŽ° Layer