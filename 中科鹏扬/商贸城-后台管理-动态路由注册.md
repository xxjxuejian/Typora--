## 介绍商贸城后台管理系统中的动态路由注册的实现



vue router 中的嵌套路由的path通常采用的都是相对路径



### 侧边栏路由显示规则：

#### 首页：

首页一般作为静态路由配置，因为不论是什么类型的用户，通常都可以访问首页。

首页通常是由根路径`/` 重定向到首页`dashboard`的。

比如：根路由是`/`，`redirect: '/dashboard`'，首页通常也使用`layout`模板渲染

根路由下面可能还有一些其它页面，同样使用`layout`模板，但是不显示在侧边栏的路由，比如：个人资料`/profile`，通过点击个人头像可以跳转，但是不显示在侧边栏中。

这里`/`和`首页`的路由结构如下：

```js
 {
    path: '/',
    component: layout,
    redirect: '/dashboard',
    meta: {
      hidden: false
    },
    children: [
      {
        path: 'profile',
        component: () => import('@/views/profile/index.vue'),
        meta: {
          title: 'profile',
          icon: 'personnel',
          hidden: true
        }
      },
      {
        path: 'dashboard',
        component: () => import('@/views/dashboard/index.vue'),
        meta: {
          title: 'dashboard',
          icon: 'dashBoard',
          hidden: false
        }
      }
    ]
  },
```

根路由`/`下面，除了首页`dashboard`以外，其它的页面的`hidden:false`，都不会显示在侧边栏中，这时候根路由下面只有一个子路由（`dashboard`）需要显示，那么就只显示这一个子路由，直接作为顶层的路由显示，和其它一级路由属于并列关系。



#### 多级路由：

如果父路由的children数组中的子路由只有一个需要显示，那么就只显示这一个子路由

如果父路由的children数组中的子路由全都不用显示，那么就把父路由作为子路由显示

如果父路由的hidden = false，但是children数组为空，同样把父路由作为子路由显示

如果父路由的hidden = false，children数组中有多个需要显示的子级路由，那么就正常显示，显示一级父路由，显示二级的子路由等等。



### 侧边栏组件：



`el-menu`组件中：

![image-20250730111039901](./../typora-pic/image-20250730111039901.png)

配合`el-sub-menu`和`el-menu-item`使用时，必须给`index`属性，这个属性时必填的。它的作用是`唯一的标识`每一条路由。

在启用 `vue-router` 模式以后，在激活导航时以 `index` 作为 `path` 进行路由跳转 使用 `default-active` 来设置加载时的激活项。这里的`index`必须是一个完整路径，比如：

```js
{
  path: '/product-manage', 
  component: 'layout',
  children: [
    {
      path: 'on-sale', // 注意：相对路径
      component: 'product-manage/on-sale/index',
    }
  ]
}
```

对应到`el-menu`中，开启`router`模式：

```vue
<el-menu :default-active="$route.path" router>
  <el-sub-menu index="/product-manage">
    <template #title>商品管理</template>
    <el-menu-item index="/product-manage/on-sale">在售商品</el-menu-item>
  </el-sub-menu>
</el-menu>
```

> <el-sub-menu index="/product-manage">
>
> 和
>
> <el-sub-menu index="/product-manage">
>
> index = '完整的路由路径'

基于这一点，后端返回的路由中，可以给出每一个路由的完整路径。如果后端没有返回完整路径，就要前端来手动处理。

由于本系统中后端没有给出每一条`route`的完整路径，所以需要前端处理。路径组件`SidebarMenu.vue`中的`base-path`正是为了计算完整路径而设计的。





### 错误：

使用path-browserify包：

```
import path from 'path-browserify'
 ReferenceError: process is not defined
```

使用path-browserify-esm 替换 path-browserify，还是报错，

直接使用

```
import path from 'https://cdn.jsdelivr.net/npm/path-browserify-esm/index.esm.js';
```

